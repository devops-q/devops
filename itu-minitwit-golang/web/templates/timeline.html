{{ define "timeline" }}
{{ if .User }}
    {{ if and (ne .Endpoint "/public") (ne .Endpoint "/") }}
        <div class="followstatus">
            {{ if eq .User.ID .ProfileUser.ID }}
                This is you!
            {{ else if .Followed }}
                You are currently following this user.
                <a class="unfollow" href="{{ printf "../%s/unfollow" .ProfileUser.Username }}">Unfollow user</a>.
            {{ else }}
                You are not yet following this user.
                <a class="follow" href="{{ printf "../%s/follow" .ProfileUser.Username }}">Follow user</a>.
            {{ end }}
        </div>
    {{ end }}

    {{ if and .User (eq .Endpoint "/") }}
        <div class="twitbox">
            <h3>What's on your mind {{ .User.Username }}?</h3>
            <form action="/add_message" method="post">
                <p><input type="text" name="text" size="60" /></p>
                <input type="submit" value="Share" />
            </form>
        </div>
    {{ end }}
{{ end }}

<ul class="messages">

    {{ range .Messages }}
    <li onload="formatTimeLocal()">
        <img src="{{ GravatarURL .Author.Email 48 }}" width="48" height="48">
        <p><strong>
            <a href="{{ .Author.Username }}">{{ .Author.Username }}</a>
        </strong>
            {{ .Text }}
            <small class="time">{{ .CreatedAt  }}</small>
        </p>
    </li>
    {{ else }}
    <li><em>There's no message so far.</em></li>
    {{ end }}
</ul>

<script>
    function formatTimeLocal() {
        var times = document.getElementsByClassName("time")
        for (let element of times) {
            var datetime = new Date(element.innerHTML)
            element.innerHTML = "Written @ " + datetime.toLocaleTimeString()
        }
    }
</script>

{{ end }}
